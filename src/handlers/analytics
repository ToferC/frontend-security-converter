use actix_web::{web, get, HttpResponse, HttpRequest, Responder};
//use actix_identity::Identity;

use tera::Context;

use crate::AppData;

#[get("/authority-analytics")]
pub async fn authority_analytics(data: web::Data<AppData>, _req:HttpRequest) -> impl Responder {
    let mut ctx = Context::new();

    let nation_codes = Nation::get_all_codes()
        .expect("Unable to retrieve nation codes");

    ctx.insert("nations", &nation_codes);

    let rendered = data.tmpl.render("nation_analytics.html", &ctx).unwrap();
    // Explicitly set the content type to text/html
    HttpResponse::Ok().content_type("text/html; charset=utf-8").body(rendered)
}